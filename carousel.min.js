"use strict";angular.module("jackrabbitsgroup.angular-carousel-directive",[]).directive("jrgCarousel",["jrgCarouselResize","$timeout",function(jrgCarouselResize,$timeout){return{restrict:"A",transclude:!0,scope:{opts:"=?"},template:function(element,attrs){var defaults={sameHeight:"0",centerOffset:"0",navNumItems:"1",alwaysShowNav:"0",showArrows:"1",hammerSwipe:"0",swipeOverlay:"0"};for(var xx in defaults)void 0===attrs[xx]&&(attrs[xx]=defaults[xx]);for(var attrsToInt=["sameHeight","centerOffset","navNumItems","alwaysShowNav","showArrows","hammerSwipe","swipeOverlay"],ii=0;ii<attrsToInt.length;ii++)attrs[attrsToInt[ii]]=parseInt(attrs[attrsToInt[ii]],10);void 0===attrs.id&&(attrs.id="jrgCarousel"+Math.random().toString(36).substring(7));var id1=attrs.id;attrs.ids={resizeEvt:id1+"ResizeEvt",content:id1+"Content"};var htmlPrev,htmlNext;htmlPrev=attrs.htmlPrev?attrs.htmlPrev:"<div class='jrg-carousel-arrow'><div class='jrg-carousel-arrow-icon fa fa-chevron-left'></div></div>",htmlNext=attrs.htmlNext?attrs.htmlNext:"<div class='jrg-carousel-arrow'><div class='jrg-carousel-arrow-icon fa fa-chevron-right'></div></div>";var html="<div class='jrg-carousel-cont-outer'><div class='jrg-carousel-cont' ";return attrs.hammerSwipe&&(html+="hm-swipeleft='nav(\"next\", {})' hm-swiperight='nav(\"prev\", {})' hm-options='{swipe_velocity: 0.2}' "),html+=">",attrs.showArrows&&(html+="<div ng-show='show.prev' class='jrg-carousel-prev' ng-click='nav(\"prev\", {})'><div class='jrg-carousel-arrow-outer flexbox center'>"+htmlPrev+"</div></div>"),attrs.swipeOverlay&&(html+="<div class='jrg-carousel-content-swipe'></div>"),html+="<div id='"+attrs.ids.content+"' class='jrg-carousel-content' style='width:{{styles.content.width}}px; margin-left:{{styles.content.marginLeft}}px;' ng-transclude></div>",attrs.showArrows&&(html+="<div ng-show='show.next' class='jrg-carousel-next' ng-click='nav(\"next\", {})'><div class='jrg-carousel-arrow-outer flexbox center'>"+htmlNext+"</div></div>"),html+="</div>",html+="</div>"},link:function(scope,element,attrs){function init(){initMaxSlides({attempt:1}),jrgCarouselResize.addCallback(attrs.ids.resizeEvt,{evtName:attrs.ids.resizeEvt,args:[]},{})}function checkCurSlide(){if("number"==typeof scope.opts.curSlide)scope.opts.curSlide<0?scope.opts.curSlide=0:scope.opts.curSlide>=maxSlides&&(scope.opts.curSlide=maxSlides-1);else if("string"==typeof scope.opts.curSlide){var allowedStrings=["first","last","next","prev","all"];allowedStrings.indexOf(scope.opts.curSlide)<0&&(scope.opts.curSlide=0)}else scope.opts.curSlide=0}function initMaxSlides(params){var ele=document.getElementById(attrs.ids.content);maxSlides=angular.element(ele).children().length,1>maxSlides&&params.attempt<3?(params.attempt++,$timeout(function(){initMaxSlides(params)},200)):(updateAnimateInfo({}),scope.nav(scope.opts.curSlide,{}))}function updateAnimateInfo(params){var ii,ele=document.getElementById(attrs.ids.content);for(animateInfo={totWidth:angular.element(ele).parent().prop("offsetWidth")},animateInfo.width=animateInfo.totWidth,ii=0;ii<ele.children.length;ii++)angular.element(ele.children[ii]).css({width:animateInfo.width.toString()+"px"});if(maxSlides=angular.element(ele).children().length,checkCurSlide({}),scope.styles.content.width=animateInfo.width*maxSlides,void 0!==attrs.navNumItems&&"width"==attrs.navNumItems&&(navNumItems=Math.floor(animateInfo.totWidth/animateInfo.width)),attrs.sameHeight){var curHeight,maxHeight=0;for(ii=0;ii<ele.children.length;ii++)curHeight=angular.element(ele.children[ii]).prop("offsetHeight"),curHeight>maxHeight&&(maxHeight=curHeight);for(ii=0;ii<ele.children.length;ii++)angular.element(ele.children[ii]).css({height:maxHeight.toString()+"px"})}animateInfo.centerOffset=attrs.centerOffset?1*attrs.centerOffset:animateInfo.totWidth/2-animateInfo.width/2,!alwaysShowNav&&animateInfo.totWidth>animateInfo.width*maxSlides?(scope.show.prev=!1,scope.show.next=!1,scope.nav("all",{})):(attrs.showArrows&&(scope.show.prev=!0,scope.show.next=!0),params.reNav&&scope.nav(scope.opts.curSlide,{}))}scope.show={prev:!0,next:!0},scope.styles={content:{width:0,marginLeft:0}};var defaultOpts={curSlide:0};void 0===scope.opts&&(scope.opts={}),scope.opts=angular.extend(defaultOpts,scope.opts);var maxSlides,animateInfo,navNumItems=attrs.navNumItems,alwaysShowNav=!1;attrs.alwaysShowNav&&(alwaysShowNav=!0),void 0!==attrs.navNumItems&&"width"!=attrs.navNumItems&&(navNumItems=attrs.navNumItems),void 0!==attrs.alwaysShowNav&&(alwaysShowNav=attrs.alwaysShowNav),scope.$on(attrs.ids.resizeEvt,function(){var delayReInit=500;updateAnimateInfo({reNav:!0}),$timeout(function(){updateAnimateInfo({reNav:!0})},delayReInit)}),scope.$on("jrgCarouselReInit",function(evt,args){updateAnimateInfo({});var ppTemp={},to=scope.opts.curSlide;args.nav&&(to=args.nav),scope.nav(to,ppTemp)}),scope.nav=function(to){{var marginLeft;document.getElementById(attrs.ids.content)}"all"==to?marginLeft=Math.floor((animateInfo.totWidth-animateInfo.width*maxSlides)/2):("prev"==to?scope.opts.curSlide>0&&(scope.opts.curSlide=scope.opts.curSlide-navNumItems,scope.opts.curSlide<0&&(scope.opts.curSlide=0)):"next"==to?scope.opts.curSlide<maxSlides-navNumItems&&(scope.opts.curSlide=scope.opts.curSlide+navNumItems,scope.opts.curSlide>=maxSlides-1&&(scope.opts.curSlide=maxSlides-1)):scope.opts.curSlide="first"==to?0:"last"==to?maxSlides-navNumItems:to,marginLeft=-1*+scope.opts.curSlide*animateInfo.width+animateInfo.centerOffset),scope.styles.content.marginLeft=marginLeft},scope.$watch("opts.curSlide",function(newVal,oldVal){angular.equals(oldVal,newVal)||(checkCurSlide({}),scope.nav(scope.opts.curSlide,{}))}),init({})}}}]).factory("jrgCarouselResize",["$rootScope",function($rootScope){var inst={callbacks:{},timeout:!1,init:function(params){var thisObj=this,defaults={timeout:500};params=angular.extend(defaults,params),window.onresize=function(){thisObj.timeout||(thisObj.timeout=setTimeout(function(){thisObj.resize({}),clearTimeout(thisObj.timeout),thisObj.timeout=!1},params.timeout))}},destroy:function(){},resize:function(){var thisObj=this;for(var xx in this.callbacks)$rootScope.$$phase?$rootScope.$broadcast(thisObj.callbacks[xx].evtName,thisObj.callbacks[xx].args):$rootScope.$apply(function(){$rootScope.$broadcast(thisObj.callbacks[xx].evtName,thisObj.callbacks[xx].args)})},addCallback:function(fxnId,fxnInfo){this.callbacks[fxnId]=fxnInfo},removeCallback:function(fxnId){this.callbacks[fxnId]&&void 0!==this.callbacks[fxnId]&&delete this.callbacks[fxnId]}};return inst.init(),inst}]);